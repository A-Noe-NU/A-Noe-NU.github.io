<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <style>

      text {
        font: 10px sans-serif;

      }

      </style>
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <title>Africa SCA Data</title>
    <link rel="stylesheet" href="./styles.css" />
  </head>
  <body>
    <div id="banner">

      <h1><h1 style=font-size:40px>Africa: Social Conflict Analysis Database</h1>
      <p1 style=font-size:20px>1990-2017</p1>
      <br>
      <br>
      <br>
      <p1 style=font-size:20px> The Social Conflict Analysis (SCA) Database is maintained by the Robert Strauss Center for International Security 
        <br>and Law at the University of Texas. It includes protests, riots, strikes, inter-communal conflict, government violence 
        <br>against civilians, and other forms of social conflict not systematically tracked in other conflict datasets from 1990-2017.</p> 
        <br>
        <br>
        <br>
        <p1 style=font-size:20px> <p1 style=font-weight:bold>Explore the data below.</p> 
      </div>

      <div>

      </div>
      <br>
      <br>
      <br>
      <p><p1 style=font-size:16px> <p1 style=font-style:italic> <p1 style=color:#Bdba85><p1 style=background-color:white>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Events and deaths by country</p>
      <div class="section" id="section1">
        <p><p1 style=font-size:20px>  Comparing the number of conflict events with the number of deaths shows some interesting outliers. <br><br><b>Nigeria</b> has had far and away the most events and deaths, as the most populous country in Africa. <br><br><b>Egypt</b> has had one of the highest number of events, but a mucher lower-than-expected number of deaths. <br><br>In contrast, countries like <b>the DRC</b> and <b>Kenya</b> have had a moderate number of events, but those events were much deadlier than events in many other countries.</p>
<svg id="scatterplot"></svg>
    
</div>
<div class="section" id="section2">
  <svg id="bars"></svg>
  <p><p1 style=font-size:20px>Test
</div>



      <script src="./banner.js"></script>

      <script>

              // set the dimensions and margins of the graph
              var margin = {top: 50, right: 150, bottom: 50, left: 50},
            width = window.innerWidth - margin.left - margin.right - 0.3*window.innerWidth,
            height = window.innerHeight - margin.top - margin.bottom - 100;
      
              // append the svg object to the body of the page
        var svg1 = d3.select("#scatterplot")
                    .attr("width", width + margin.left + margin.right)
                    .attr("height", height + margin.top + margin.bottom)
                    .append("g")
                    .attr("transform",
                          "translate(" + margin.left + "," + margin.top + ")");

        d3.queue()
          .defer(d3.csv, "scad_data.csv")
          .defer(d3.csv, "africa_pop_data.csv")
          .awaitAll(function(error, responses) {
            
            var data = responses[0];
            var pop_data = responses[1];

        if (error) {
            console.log(error);
        }
        else {
            console.log("Africa SCA Data");
        }

         pop_data.forEach(function(pop_data) {
            pop_data.Population_UN = parseFloat(pop_data.Population_UN);
          });

        data.forEach(function(d) {
            d.ndeath = parseFloat(d.ndeath);
                    });

        var tooltip = d3.select("#section1")
                        .append('div')
                        .style("opacity", 1)
                        .style("border-width", "1px")
                        .style("color", "#Bdba85")
                        .attr("class", "tooltip")
                        .style("background-color", "white")
                        .style("border-width", "2px")
                        .style("border-radius", "5px")
                        .style("padding", "5px")
                        .style("font-size", "18px")
                        .style("position", "absolute")

        var mouseover = function(d) {
                tooltip
                  .style("opacity", 1)
                d3.select(this)
                  .style("stroke", "#Bdba85")
                  .style("stroke-width", 6)
                  .style("top", d3.event.pageY + 10 + "px")
                  .style("left", d3.event.pageX + 10 +"px");
              }

        var mousemove = function(d) {
          tooltip
            .html("<b>" + d.Country_Name + "</b>: " + d.Sum_of_nDeath + " deaths in " + d.count + " events between 1990 and 2017.")
            .style("top", d3.event.pageY + 10 + "px")
                  .style("left", d3.event.pageX + 10 +"px");
        }
        
        var mouseleave = function(d) {
          tooltip
            .style("opacity", 0)
          d3.select(this)
            .style("stroke", "#Bdba85")
            .style("stroke-width", 4)
            .style("opacity", 1)
        }

        var data_by_country = d3.nest()
            .key(function(d) {return d.countryname;})
            .rollup(function(v) {
              return {
                cnt: v.length,
                ndeathSum: d3.sum(v, function(d) {return d.ndeath; }),
                escRate: d3.sum(v, function(d) {return d.escalation / v.length}),
                latitude: v.latitude,
                longitude: v.longitude,
                values: v
              };
            })
            .entries(data)
            .map(function(d) {
              return {
                Country_Name: d.key,
                Sum_of_nDeath: d.value.ndeathSum,
                count: d.value.cnt,
                values: d.value.values,
                latitude: d.value.latitude,
                longitude: d.value.longitude,
                escRate: d.value.escRate
               };
              });

                console.log("Data by Country", data_by_country);
                ;

          // add X axis
        var x = d3.scaleLinear()
          .domain([0, 2600])
          .range([ 0, width]);
          svg1.append("g")
          .attr("transform", "translate(0," + height + ")")
          .call(d3.axisBottom(x));

          // add population scale for sizing
        var popScale = d3.scaleLinear()
          .domain([0, d3.max(pop_data, function(d) { return d.Population_UN; })])
          .range([0, 50]);

          
          // add Y axis
        var y = d3.scaleLinear()
          .domain([0, 50000])
          .range([ height, 0]);
          svg1.append("g")
          .call(d3.axisLeft(y));

          // add circles
          svg1.selectAll()
            .append('g')
            .data(data_by_country)
            .enter()
            .append("circle")
            .attr("cx", function (d, i) { return x(d.count)})
            .attr("cy", function (d, i) { return y(d.Sum_of_nDeath)})
            .attr("r", function(d) {
              var pop = pop_data.filter(p => p.Country === d.Country_Name);
              if (pop.length) {
                return popScale(pop[0].Population_UN); 
              }
              else {
                console.log("Missing Population", d.Country_Name);
                return popScale(0);
              }
            })
            .style("stroke", "#Bdba85")
            .style("stroke-width", 4)
            .style("stroke-opacity", "70%")
            .style("fill", "white")
            .style("fill-opacity", "0%")      
            .on("mouseover", mouseover)
            .on("mousemove", mousemove)
            .on("mouseleave", mouseleave)

            // add X axis label

            // add Y axis label
            
            var chartHeight = height - margin.top - margin.bottom;
            
            var svg2 = d3.select("#bars")
            .data(data_by_country)
                    .attr("width", width + margin.left + margin.right)
                    .attr("height", height + margin.top + margin.bottom)

            var barHeight = d3.scaleLinear()
            .domain([0, 30])
            .range([0, chartHeight]);
            svg2.append("g")
            .call(d3.axisLeft(x));

            var barX = d3.scaleLinear()
            .domain(0, 54)
            .range([0, width]);
            svg2.append("g")
            .attr("transform", "translate(0," + height + ")")
            .call(d3.axisBottom(barX))


                    .append("g")
                    .append("rect")
                    .attr("transform",
                          "translate(" + margin.left + "," + margin.top + ")");

            var bars = svg2.select("#shapes").selectAll(".bar")
            .data(data, function(d) {
              return d.Country_Name;
            });
            
          // Bars
          svg2.selectAll()
          .append('g')
          .enter()
          .append("rect")
            .attr("class", "bar")
            .attr("fill", "#Bdba85")
            .attr("width", "5px")
            .attr("height", function(d) {
                return barHeight(100*d.escRate);
              })
            .attr("x", "5");



        }
            )
            
            ;;

      </script>
    </body>
  </body>
</html>